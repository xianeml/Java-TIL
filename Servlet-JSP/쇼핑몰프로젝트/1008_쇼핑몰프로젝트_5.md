# 16. ì¹´íŠ¸ ì „ì²´ ì‚­ì œ

### cartList.jsp:

```java
<a class="a_black" href="#" id="delAllCart"> ì „ì²´ ì‚­ì œí•˜ê¸°</a>
&nbsp;&nbsp;&nbsp;&nbsp;
<a class="a_black" href="#" id="delAllCart2"> ì „ì²´ ì‚­ì œí•˜ê¸°2</a>
&nbsp;&nbsp;&nbsp;&nbsp;
```

```java
<!-- checkboxëŠ” ì²´í¬ëœ ê°’ë§Œ ì„œë¸”ë¦¿ìœ¼ë¡œ ë„˜ì–´ê°„ë‹¤. ë”°ë¼ì„œ valueì— ì‚­ì œí•  numê°’ì„ ì„¤ì •í•œë‹¤. -->
<input type="checkbox" name="check" id="check81"
	class="check" value="<%=num %>">
```

```java
//ì „ì²´cart ì‚­ì œ1 delallCart
	//ì „ì²´ì„ íƒ ë˜ëŠ” ì„ íƒ
	//num[]ì— ì„ íƒí•œ checkì˜ valueì— ë‹´ì•„ì„œ CartDelAllServlet?data=numì „ë‹¬
$("#delAllCart").on("click", function(){
	var num = [];
	$("input:checkbox[name='check']:checked").each(function(idx, ele){
		num[idx]=$(this).val();
	});
	console.log(num);
	location.href="CartDelAllServlet?data="+num;
})
```

:checkbox í•„í„°ëŠ” ì¸í’‹ì˜ íƒ€ì…ì´ ì²´í¬ë°•ìŠ¤ì¸ ìš”ì†Œë“¤ì„ ë°˜í™˜í•œë‹¤.

[ ] ì´ ê´„í˜¸ ì•ˆì— ë“¤ì–´ê°€ìˆëŠ”ê±´ ì†ì„±ì„ ë‚˜íƒ€ë‚¸ë‹¤. ì²´í¬ë°•ìŠ¤ì¤‘ì—ì„œ ë„¤ì„ì†ì„±ê°’ì´ checkì¸ ì• ë“¤ì„ ë˜ í•œë²ˆ ê±°ë¥´ê³  ê·¸ì¤‘ì—ì„œ checked ëœ ì• ë“¤ì„ ë˜ ê±¸ëŸ¬ì¤€ë‹¤.

.each()í•¨ìˆ˜ëŠ” ì´ ìš”ì†Œë“¤ì„ ì¸ë±ìŠ¤ ë¶™ì—¬ì„œ ë°˜ë³µìˆœíšŒí•´ì¤€ë‹¤. ë”°ë¼ì„œ numë°°ì—´ ìš”ì†Œ í•˜ë‚˜í•˜ë‚˜ì— checkedëœ ìš”ì†Œë“¤ì˜ ë°¸ë¥˜ë¥¼ ë„£ì–´ì£¼ê²Œ ëœë‹¤.

ê·¸ ë°°ì—´ ë°ë¦¬ê³  ì¹´íŠ¸ì „ì²´ì‚­ì œì„œë¸”ë¦¿ìœ¼ë¡œ ê°„ë‹¤.

### CartDelAllServlet:

```java
HttpSession session = request.getSession();
MemberDTO dto = (MemberDTO)session.getAttribute("login");
String nextPage = null;
if(dto!=null) {
	String data = request.getParameter("data");
	System.out.println(data);
```

ë„˜ì–´ì˜¨ ë°°ì—´ë°ì´í„° í™•ì¸í•´ë³´ë©´ 8,9,10 ì´ëŸ°ì‹ìœ¼ë¡œ ë‚˜ì—´ë˜ì–´ ì „ë‹¬ì´ ëœë‹¤. ê·¸ê±¸ ì§¤ë¼ì„œ ë¦¬ìŠ¤íŠ¸ì— ë„£ëŠ”ë‹¤.

```java
String [] x = data.split(",");
List<String> list = Arrays.asList(x);
```

```java
	CartService service = new CartService();
	int n = service.cartAllDel(list);
	nextPage = "CartListServlet";
}else {
		nextPage = "LoginUIServlet";
		session.setAttribute("mesg", "ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì‘ì—…ì…ë‹ˆë‹¤.");
	}
	response.sendRedirect(nextPage);
```

ìŠ¤í”Œë¦¿ìœ¼ë¡œ , êµ¬ë¶„ìë¡œ ë°ì´í„°ë¥¼ ì˜ë¼ì„œ ë°°ì—´ x ì— ë„£ì–´ì¤¬ë‹¤.

ì´ ë°°ì—´ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ë§Œë“¤ì–´ì„œ ë¦¬ìŠ¤íŠ¸ì— ì €ì¥í•´ì£¼ê³  ì„œë¹„ìŠ¤ì— ë„˜ê²¨ì¤¬ë‹¤.

dbìˆ˜ì • í›„ ë¦¬ìŠ¤íŠ¸ì„œë¸”ë¦¿ìœ¼ë¡œ ì¹´íŠ¸ ëª©ë¡ ë‹¤ì‹œ ë„ì›Œì¤Œ(ì „ì²´ì‚­ì œí›„ë¡œ ë°ì´í„°ê°€ì—†ìŒ)

### CartService:

```java
public int cartAllDel(List<String> list) {
		SqlSession session = MySqlSessionFactory.getSession();
		CartDAO dao = new CartDAO();
		int n = 0;
		try {
			n = dao.cartAllDel(session, list);
			session.commit();
		}catch (Exception e) {
			e.printStackTrace();
		} finally {
			session.close();
		}
		return n;
	}
```

ë”œë¦¬íŠ¸ ê²°ê³¼ëŠ” ì‹¤í–‰íšŸìˆ˜ í‘œì‹œ ìœ„í•´ int ë³€ìˆ˜ì— ë‹´ì•„ì¤€ë‹¤.

### CartDAO:

```java
public int cartAllDel(SqlSession session, List<String> list) {
		int n = session.delete("CartMapper.cartAllDel", list);
		return n;
	}
```

### CartMapper.xml:

```java
<delete id="cartAllDel" parameterType="arrayList">
	delete from cart
	where num in
	<foreach item="item" index="index" collection="list"
		open="(" separator ="," close=")">
		#{item}
	</foreach>
</delete>
```

ì»¬ë ‰ì…˜ì— ë¦¬ìŠ¤íŠ¸ì¨ì¤˜ì„œ íŒŒë¼ë¯¸í„°íƒ€ì…ì— ë˜ ë¦¬ìŠ¤íŠ¸ ì“¸í•„ìš”ì—†ê³  in () ì´ê²Œ ë¬¸ë²•ì´ë¼ì„œ ì˜¤í”ˆí´ë¡œì¦ˆ ì†ì„± ì¨ì£¼ëŠ”ê±°ì„

ë™ì sql. ì´ ë¦¬ìŠ¤íŠ¸ì˜ ìš”ì†Œë¥¼ ì•„ì´í…œì´ë€ ì´ë¦„ìœ¼ë¡œ í•˜ë‚˜ì”© ë‹¤ êº¼ë‚´ì¤Œ.

ì´ê±°ëŠ” ì „ì²´ì‚­ì œê°€ ì•„ë‹ˆë¼ ì„ íƒí•œê±° ë©€í‹°ì‚­ì œë‹¤

# 17. ì£¼ë¬¸ í˜ì´ì§€

### cartList.jsp:

```java
<td><input type="button" value="ì£¼ë¬¸" class="orderBtn" data-xxx="<%= num%>"></td>
```

```java
///ì£¼ë¬¸ë²„íŠ¼
//data-xxxì´ìš© CartOrderConfirmServlet?num="+num;
$(".orderBtn").on("click", function(){
	var num = $(this).attr("data-xxx");
	console.log(num);
	location.href="CartOrderConfirmServlet?num="+num;
})
```

ì£¼ë¬¸ë²„íŠ¼ í´ë¦­í•˜ë©´ num ë°ë¦¬ê³  ì˜¤ë”í¼ ì„œë¸”ë¦¿ìœ¼ë¡œ ê°„ë‹¤

### CartOrderConfirmServlet:

```java
HttpSession session = request.getSession();
MemberDTO dto = (MemberDTO)session.getAttribute("login");
String nextPage = null;
if(dto!=null) {
	//numì´ìš© ì¥ë°”êµ¬ë‹ˆ ì •ë³´ ì¡°íšŒ
	String num = request.getParameter("num");
	CartService cService = new CartService();
	CartDTO cdto = cService.cartByNum(Integer.parseInt(num));
	//userid ì´ìš© ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
	String userid = dto.getUserid();
	MemberService mService = new MemberService();
	MemberDTO mdto = mService.mypage(userid);

	request.setAttribute("cdto", cdto);
	request.setAttribute("mdto", mdto);

	nextPage = "orderConfirm.jsp";
}else {
	nextPage = "LoginUIServlet";
	session.setAttribute("mesg","ë¡œê·¸ì¸í•„ìš”");
}

RequestDispatcher dis = request.getRequestDispatcher(nextPage);
dis.forward(request, response);
```

num ë°›ì•„ì˜¤ê³  ì´ê±¸ë¡œ ì¥ë°”êµ¬ë‹ˆ ì •ë³´ ì¡°íšŒí•˜ê¸° ìœ„í•´ ì¹´íŠ¸dto íƒ€ì… ë³€ìˆ˜ì— ì¿¼ë¦¬ ê²°ê³¼ ë°›ì•„ì˜¨ë‹¤.

ìœ ì €ì•„ì´ë””ë¡œ ë©¤ë²„dtoíƒ€ì… ë³€ìˆ˜ì— ê²°ê³¼ ë°›ì•„ì˜¤ê³ . ì´ ë‘ê°œ ì •ë³´ë¥¼ ì´ìš©í•´ ì£¼ë¬¸í¼ ë§Œë“¤ê±°ë‹¤.

ë‘˜ë‹¤ ë¦¬í€˜ìŠ¤íŠ¸ì— ì €ì¥í•˜ê³  ë‹¤ìŒí˜ì´ì§€ì—ì„œë„ ì“¸ ìˆ˜ ìˆë„ë¡ ë””ìŠ¤íŒ¨ì³ í¬ì›Œë“œë¥¼ ì‚¬ìš©í•œë‹¤.

### CartService:

```java
public CartDTO cartByNum(int num) {
	SqlSession session = MySqlSessionFactory.getSession();
	CartDAO dao = new CartDAO();
	CartDTO cdto = null;
	try {
		cdto = dao.cartByNum(session, num);
		session.commit();
	}catch (Exception e) {
		e.printStackTrace();
	} finally {
		session.close();
	}
	return cdto;
}
```

### CartDAO:

```java
public CartDTO cartByNum(SqlSession session, int num) {
	CartDTO cdto = session.selectOne("CartMapper.cartbyNum", num);
	return cdto;
}
```

### CartMapper.xml:

```java
<select id="cartbyNum" parameterType="int" resultType="CartDTO">
		select num, userid, gCode, gName, gPrice, gSize, gColor, gAmount,
		gImage
		from cart
		where num = #{num}
	</select>
```

### orderConfirm.jsp:

```java
<h1>ì£¼ë¬¸ì •ë³´ í™”ë©´ì…ë‹ˆë‹¤. </h1>
<jsp:include page="common/top.jsp" flush="true"></jsp:include><br>
<jsp:include page="common/menu.jsp" flush="true"></jsp:include>
<hr>
<jsp:include page="order/orderConfirm.jsp" flush="true"></jsp:include>
```

### order/orderConfirm.jsp:ğŸ¤¯

```java
<%
	CartDTO cdto = (CartDTO)request.getAttribute("cdto");
	int num = cdto.getNum();
	String gCode = cdto.getgCode();
	String gName = cdto.getgName();
	int gPrice = cdto.getgPrice();
	String gSize = (String) cdto.getgSize();
	String gColor = (String) cdto.getgColor();
	int gAmount = cdto.getgAmount();
	String gImage = cdto.getgImage();

	MemberDTO mdto = (MemberDTO)request.getAttribute("mdto");
	String userid = mdto.getUserid();
	String username = mdto.getUsername();
	String post = mdto.getPost();
	String addr1 = mdto.getAddr1();
	String addr2 = mdto.getAddr2();
	String phone1 = mdto.getPhone1();
	String phone2 = mdto.getPhone2();
	String phone3 = mdto.getPhone3();
	String email1 = mdto.getEmail1();
	String email2 = mdto.getEmail2();

%>
```

```java
<form name="myForm" method="get" action="CartOrderDoneServlet">
	<input type="hidden" name="orderNum" value="<%=num%>"> <!-- ì¹´íŠ¸ë²ˆí˜¸ -->
	<input type="hidden" name="gCode" value="<%=gCode %>">
	<input type="hidden" name="gName" value="<%=gName %>">
	<input type="hidden" name="gPrice" value="<%=gPrice %>">
	<input type="hidden" name="gSize" value="<%=gSize %>">
	<input type="hidden" name="gColor" value="<%=gColor %>">
	<input type="hidden" name="gAmount" value="<%=gAmount %>">
	<input type="hidden" name="gImage" value="<%=gImage %>">
```

í•„ìš”í•œ ë°ì´í„° íŒŒì‹±í•˜ê³  í¼ ì‘ì„±

```java
$(document).ready(function(){
	//ì£¼ì†Œì§€ ì²˜ë¦¬
	$("#same").on("click", function(){
		if(this.checked){
			$("#orderName").val($("#mname").val());
			$("#sample4_postcode").val($("#mpost").val());
			$("#sample4_roadAddress").val($("#maddress1").val());
			$("#sample4_jibunAddress").val($("#maddress2").val());
			$("#phone").val($("#mphone").val());
		}else{
			$("#orderName").val("");
			$("#sample4_postcode").val("")
			$("#sample4_roadAddress").val("")
			$("#sample4_jibunAddress").val("")
			$("#phone").val("");
		}
	})
});
```

ë°°ì†¡ì§€ê°€ ê°™ì„ ê²½ìš° same ì²´í¬ë°•ìŠ¤ í´ë¦­í•˜ë©´ ìœ ì € ì£¼ì†Œê°€ ê·¸ëŒ€ë¡œ ì£¼ì†Œì§€ ì¸í’‹ì— ë³µì‚¬ë˜ê²Œ ì´ë²¤íŠ¸ ì²˜ë¦¬

# 18. ì£¼ë¬¸ì™„ë£Œ í˜ì´ì§€

```sql
--ì£¼ë¬¸ í…Œì´ë¸”
     create table orderInfo
  (  num NUMBER(6) PRIMARY KEY,
     userid VARCHAR2(10),
     gCode varchar2(20) not null,
     gName varchar2(50) not null,
     gPrice NUMBER(6) not null,
     gSize CHAR(1) not null,
     gColor VARCHAR2(10) not null,
     gAmount NUMBER(2) not null,
     gImage varchar2(20) not null,
     orderName VARCHAR2(10) NOT NULL,
     post VARCHAR2(5) NOT NULL,
     addr1 VARCHAR2(500) NOT NULL,
     addr2 VARCHAR2(500) NOT NULL,
     phone VARCHAR(12) NOT NULL,
     payMethod VARCHAR2(10) NOT NULL,
     orderDay DATE  DEFAULT SYSDATE
  );
  alter table orderInfo
  add CONSTRAINT orderInfo_userid_fk FOREIGN KEY(userid)
   REFERENCES member(userid) ON DELETE CASCADE;


  alter table orderInfo
  add CONSTRAINT orderInfo_gCode_fk FOREIGN KEY(gCode)
   REFERENCES goods(gCode) ON DELETE CASCADE;

   create sequence orderInfo_seq;
```

orderì •ë³´ë¥¼ ìœ„í•œ ì£¼ë¬¸ í…Œì´ë¸” ë§Œë“¤ê¸°

### OrderDTO:

```java
package com.dto;

public class OrderDTO {
	int num;
	String userid;
	String gCode;
	String gName;
	int gPrice;
	String gSize;
	String gColor;
	int gAmount;
	String gImage;
	String orderName;
	String post;
	String addr1;
	String addr2;
	String phone;
	String payMethod;
	String orderday;
```

### CartOrderDoneServlet:

```java
HttpSession session = request.getSession();
MemberDTO dto = (MemberDTO)session.getAttribute("login");
String nextPage = null;
if(dto!=null) {

	String orderNum = request.getParameter("orderNum");
	String userid = dto.getUserid();
	String gCode = request.getParameter("gCode");
	String gName = request.getParameter("gName");
	String gPrice = request.getParameter("gPrice");
	String gSize = request.getParameter("gSize");
	String gColor = request.getParameter("gColor");
	String gAmount = request.getParameter("gAmount");
	String gImage = request.getParameter("gImage");
	String orderName = request.getParameter("orderName");
	String post = request.getParameter("post");
	String addr1 = request.getParameter("addr1");
	String addr2 = request.getParameter("addr2");
	String phone = request.getParameter("phone");
	String payMethod = request.getParameter("payMethod");

	OrderDTO dto2 = new OrderDTO(0, userid, gCode, gName, Integer.parseInt(gPrice),
			gSize, gColor, Integer.parseInt(gAmount), gImage, orderName, post, addr1, addr2, phone, payMethod, null);


	CartService service = new CartService();
	int n = service.orderDone(dto2, orderNum);
	System.out.println("ser:"+n);
	request.setAttribute("order", dto2);
	nextPage = "orderDone.jsp";
}else {
	nextPage = "LoginUIServlet";
	session.setAttribute("mesg", "ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì‘ì—…ì…ë‹ˆë‹¤.");
}
RequestDispatcher dis = request.getRequestDispatcher(nextPage);
dis.forward(request, response);
```

ì˜¤ë” ì»¨íŒ.jspì—ì„œ ë„˜ì–´ì˜¨ ë°ì´í„°ë“¤ íŒŒì‹±í•´ì„œ orderdto ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. ê·¸ê±¸ ì„œë¹„ìŠ¤ì— ë„˜ê²¨ì£¼ê³  ì¿¼ë¦¬ê°€ ëë‚˜ë©´ ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤.

### CartService:

```java
public int orderDone(OrderDTO dto2, String orderNum) {
		SqlSession session = MySqlSessionFactory.getSession();
		CartDAO dao = new CartDAO();
		int n = 0;
		try {
			n = dao.orderDone(session, dto2);
			n = dao.cartDel(session, Integer.parseInt(orderNum));
			session.commit();
		} catch (Exception e) {
			e.printStackTrace();
			session.rollback();
		} finally {
			session.close();
		}
		return n;
	}
```

ì£¼ë¬¸ í…Œì´ë¸”ì— insertí•˜ëŠ” ë™ì‹œì— ì¥ë°”êµ¬ë‹ˆ í…Œì´ë¸”ì—ì„œ ë°ì´í„°ë¥¼ ì‚­ì œí•´ì¤€ë‹¤.

### CartDAO:

```java
public int orderDone(SqlSession session, OrderDTO dto2) {
		int n = session.insert("OrderMapper.orderDone", dto2);
		System.out.println("dao:"+n);
		return n;
	}
```

### OrderMapper.xml:

```java
<insert id="orderDone" parameterType="OrderDTO">
		insert into orderinfo (num, userid, gCode, gName, gPrice, gSize, gColor, gAmount, gImage,
		 orderName, post, addr1, addr2, phone, payMethod)
		values (orderInfo_seq.nextval, #{userid}, #{gCode}, #{gName}, #{gPrice},
		#{gSize}, #{gColor}, #{gAmount}, #{gImage}, #{orderName},
		#{post}, #{addr1}, #{addr2}, #{phone}, #{payMethod} )
	</insert>
```

ìƒˆë¡œ ordermapperë¥¼ ë§Œë“¤ì—ˆë‹¤. ì»¨í”¼ê²¨ ë“±ë¡í•´ì„œ ì“°ê¸°.

### orderDone.jsp:

```java
<h1>ê²°ì œ í™”ë©´ì…ë‹ˆë‹¤. </h1>
<jsp:include page="common/top.jsp" flush="true"></jsp:include><br>
<jsp:include page="common/menu.jsp" flush="true"></jsp:include>
<hr>
<jsp:include page="order/orderDone.jsp" flush="true"></jsp:include>
```

### order/orderDone.jsp:

```java
<%
  	OrderDTO dto = (OrderDTO)request.getAttribute("order");
	String userid = dto.getUserid();
	int gAmount = dto.getgAmount();
	String post = dto.getPost();
	String gName = dto.getgName();
	int gPrice = dto.getgPrice();
	String orderName = dto.getOrderName();
	String phone = dto.getPhone();
	String addr1 = dto.getAddr1();
	String addr2 = dto.getAddr2();
	String payMethod = dto.getPayMethod();

%>
```

```java
<%=userid %></b> ë‹˜ì˜ ì£¼ë¬¸ì´	ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.
```

ë°ì´í„° íŒŒì‹±í•˜ê³  í•„ìš”í•œ ë¶€ë¶„ì— ë³€ìˆ˜ ì‚¬ìš©.
